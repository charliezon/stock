{% extends '__base__.html' %}

{% block title %}收益率排行{% endblock %}

{% block beforehead %}

<script src="/static/js/echarts/echarts.min.js"></script>
<script src="/static/js/echarts/theme/shine.js"></script>

<script type="text/javascript">

function initVM(data) {
    var vm = new Vue({
        el: '#vm',
        data: data,
        methods: {
            submit: function (event) {
                event.preventDefault();
                location.href = '/profit_rank/'+$('#start_date').val()+'/'+$('#end_date').val();
            }
        }
    });
    $("#start_date").val(getTodayString());
    $("#end_date").val(getTodayString());
    $('#vm').show();
}

$(function () {
    $('#loading').hide();
    initVM({

    });
    $("#profit_curve").css( 'width', $("#profit_curve").width() );
    profit_curve_chart = echarts.init(document.getElementById('profit_curve'), 'shine');

    option = {
        title: {
            text: '收益率曲线',
            subtext: '逐月收益率曲线'
        },
        grid: [
            {
                top: 100
            }
        ],
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data:[
                {% if data %}
                    {% for d in data.legends %}
                        {% if loop.index!=1 %},{% endif %}'{{d}}'
                    {% endfor %}
                {% endif %}
            ],
            left: '10%',
            right: '10%'
        },
        toolbox: {
            show: true,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                dataView: {readOnly: false},
                magicType: {type: ['line', 'bar']},
                restore: {},
                saveAsImage: {}
            }
        },
        xAxis:  {
            type: 'category',
            boundaryGap: false,
            data: [
                {% if data %}
                    {% for d in data.x_data %}
                        {% if loop.index!=1 %},{% endif %}'{{d}}'
                    {% endfor %}
                {% endif %}
            ]
        },
        yAxis: {
            type: 'value',
            axisLabel: {
                formatter: '{value}%'
            }
        },
        series: [
            {% if data %}
                {% for d in data.y_data %}
                    {
                        name:'{{data.legends[loop.index-1]}}',
                        type:'line',
                        smooth: true,
                        data:[
                            {% if d %}
                                {% for i in d %}
                                    {% if loop.index!=1 %},{% endif %}{{i}}
                                {% endfor %}
                            {% endif %}
                        ]
                    },
                {% endfor %}
            {% endif %}
        ]
    };

    profit_curve_chart.setOption(option);
});
</script>
{% endblock %}

{% block content %}

<h2>查看指定时间段的收益率排行榜</h2>
<div id="vm" class="uk-width-1-1">
    <form v-on="submit: submit" class="uk-form uk-form-horizontal">
        <div class="uk-alert uk-alert-danger uk-hidden"></div>
        <div class="uk-form-row">
            <label class="uk-form-label" for="start_date"><strong>开始日期</strong></label>
            <div class="uk-form-controls">
                <input id="start_date" v-model="start_date" name="start_date" type="text" data-uk-datepicker="{format:'YYYY-MM-DD'}" class="uk-width-1-1">
            </div>
        </div>
        <div class="uk-form-row">
            <label class="uk-form-label" for="end_date"><strong>结束日期</strong></label>
            <div class="uk-form-controls">
                <input id="end_date" v-model="end_date" name="end_date" type="text" data-uk-datepicker="{format:'YYYY-MM-DD'}" class="uk-width-1-1">
            </div>
        </div>
        <div class="uk-form-row">
            <button type="submit" class="uk-button uk-button-primary"><i class="uk-icon-save"></i> 查询</button>
        </div>
    </form>
</div>

{% if data %}
<div id="profit_curve" style="width: 100%;height:600px;padding-top:1cm;"></div>
{% endif %}

{% if ranks %}
    {% for rank in ranks %}
    <h2>{{rank.year}}年{{rank.month}}月收益率排行榜</h2>
    <table class="uk-table uk-table-hover uk-table-striped uk-table-condensed uk-text-nowrap">
        <thead>
            <tr>
                <th>排行</th>
                <th>账户名</th>
                <th>收益率</th>
                <th>平均本金</th>
                <th>收益</th>
            </tr>
        </thead>
        <tbody>
            {% for account in rank.accounts %}
            <tr >
                <td><div class="uk-badge">{{loop.index}}</div></td>
                <td>{{account.account_name}}</td>
                <td>{{account.profit_rate}}%</td>
                <td>{{account.cost}}</td>
                <td>{{account.profit}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endfor %}
{% endif %}
{% if rank %}
    <h2>{{start_date}}至{{end_date}}收益率排行榜</h2>
    <table class="uk-table uk-table-hover uk-table-striped uk-table-condensed uk-text-nowrap">
        <thead>
            <tr>
                <th>排行</th>
                <th>账户名</th>
                <th>收益率</th>
                <th>平均本金</th>
                <th>收益</th>
            </tr>
        </thead>
        <tbody>
            {% for account in rank %}
            <tr >
                <td><div class="uk-badge">{{loop.index}}</div></td>
                <td>{{account.account_name}}</td>
                <td>{{account.profit_rate}}%</td>
                <td>{{account.cost}}</td>
                <td>{{account.profit}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <a href="/profit_rank" class="uk-button uk-button-primary"><i class="uk-icon-sort-amount-asc"></i> 按月查看收益率排行榜</a>
{% endif %}
{% endblock %}